<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.betterhy.db.dao.extend.OaSigninMapperExtend">
    <resultMap id="BaseResultMap" type="java.util.HashMap">
        <result column="USER_ID" jdbcType="INTEGER" property="userId"/>
        <result column="USERNAME" jdbcType="VARCHAR" property="username"/>
        <result column="laterOrEarlierTimes" jdbcType="INTEGER" property="laterOrEarlierTimes"/>
        <result column="leaveTimes" jdbcType="INTEGER" property="leaveTimes"/>
        <result column="businessTimes" jdbcType="INTEGER" property="businessTimes"/>
        <result column="normalTimes" jdbcType="INTEGER" property="normalTimes"/>
    </resultMap>

    <select id="queryUserSigninInfo" parameterType="java.util.HashMap" resultMap="BaseResultMap">
        SELECT USER_ID, USERNAME, laterOrEarlierTimes, leaveTimes, businessTimes, normalTimes
        FROM
            (
                SELECT USER_ID, USERNAME,
                    SUM(IF(SIGNIN_STATUS = 3 OR SIGNIN_STATUS = 4, 1, 0)) laterOrEarlierTimes,
                    SUM(IF(SIGNIN_STATUS = 1, 1, 0)) leaveTimes,
                    SUM(IF(SIGNIN_STATUS = 2, 1, 0)) businessTimes,
                    SUM(IF(SIGNIN_STATUS = 0, 1, 0)) normalTimes
                FROM
                    oa_signin
                WHERE SIGNIN_DATE &gt;= #{beginDate}
                    AND SIGNIN_DATE &lt;= #{endDate}
                <if test="username != null">
                    AND USERNAME like concat(concat('%',#{username}),'%')
                </if>
                GROUP BY USER_ID, USERNAME
            ) a

    </select>

</mapper>